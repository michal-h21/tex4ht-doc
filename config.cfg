\Preamble{xhtml,html5,mathml,2,sec-filename,info,fn-in,fonts}
% external stylesheet
\Configure{AddCss}{style.css}

% ToDo: implement minitoc as in this answer: https://tex.stackexchange.com/a/361886/2891
\Configure{crosslinks+}{%
  \bgroup
  % container for the page toc
  \Configure{tableofcontents}{\IgnorePar\EndP\HCode{<nav class="TOC">}\IgnorePar}
  {}{\IgnorePar\HCode{</nav>\Hnewline}\ShowPar}{}{}%
  \TableOfContents[chapter,section,subsection]% Print table of contents before crosslinks
  \egroup
  \ifvmode\IgnorePar\fi\EndP%
  \HCode{<article class="main-content">\Hnewline<nav class="crosslinks-top">} }
  {\HCode{</nav>\Hnewline}}
{\ifvmode\IgnorePar\fi\EndP%
  \HCode{<nav class="crosslinks-bottom">}}{\HCode{</nav>}}{}{}

% configuration for TON on the main page
\Configure{tableofcontents}{\IgnorePar\EndP\HCode{<nav class="TOC">}\IgnorePar}
{}{\IgnorePar\HCode{</nav>\Hnewline<article class="main-content">\Hnewline}\ShowPar}{}{}%

% close the <article> element started in \Configure{crosslinks+}
\Configure{@/BODY}{\ifvmode\IgnorePar\fi\EndP\HCode{</article>}}

% show only crosslinks to prev, main and next pages
\Configure{crosslinks*}{prev}{up}{next}{}

\Configure{texttt}{\HCode{<code>}\NoFonts}{\EndNoFonts\HCode{</code>}}
\Configure{verb}{\HCode{<code>}\NoFonts}{\EndNoFonts\HCode{</code>}}
\ConfigureEnv{texsource}{\ifvmode\IgnorePar\fi\EndP\HCode{<figure class="texsource">}}{\ifvmode\IgnorePar\fi\EndP\HCode{</figure>}}{}{}
\ConfigureEnv{shellcommand}{\ifvmode\IgnorePar\fi\EndP\HCode{<figure class="shellcommand">}}{\ifvmode\IgnorePar\fi\EndP\HCode{</figure>}}{}{}
\ConfigureEnv{htmlsource}{\ifvmode\IgnorePar\fi\EndP\HCode{<figure class="htmlsource">}}{\ifvmode\IgnorePar\fi\EndP\HCode{</figure>}}{}{}

\begin{document}
\EndPreamble
