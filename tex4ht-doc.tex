\documentclass{book}
\usepackage{url}
\usepackage{xcolor}
\usepackage{array}
\usepackage{graphicx}

% \usepackage[T1]{fontenc}
\usepackage{upquote}
\usepackage{textcomp}
\usepackage{hyperref}
\usepackage{csquotes}
\usepackage{tex4ht-styles}



\usepackage{glossaries}
\title{TeX4ht Documentation}

\author{by TeX4ht Project}

\begin{document}

\maketitle

% Don't introduce table of contents in the HTML mode, as it introduces another page
\ifdefined\HCode\else\tableofcontents\fi


\chapter{Introduction}


\begin{acknowledgements}
This work was supported with financial support from \href{https://cstug.cz/}{CSTUG}.
\end{acknowledgements}

\chapter{Basic Tutorial}
\input{sections/tutorial}
\chapter{How to}

\section{Change design}
\subsection{Basics}

By default, \texfourht\ separates paragraphs by space. If you want to use text indenting instead, try the \option{p-indent} option.

\subsection{CSS}
\subsection{Web fonts}

It is easy to change fonts in web pages using CSS, but if you want to use
actual font files for the distribution, for example, in an Epub file, \texfourht
provides the following configurations. This example shows how to use OTF files
for the EB Garamond font. 

\begin{texsource}
% define font family. The first argument is family name
% that can be used in CSS font-family rule
% second argument is the family name declared by the font
\Configure{FontFamily}{rmfamily}{EB Garamond}
% declare font filenames for particular font styles. 
% the font files must be placed in the location that is
% declared.
% these four font styles are supported
\Configure{NormalFont}{EBGaramond-Regular.otf}
\Configure{ItalicFont}{EBGaramond-Italic.otf}
\Configure{BoldFont}{EBGaramond-Bold.otf}
\Configure{BoldItalicFont}{EBGaramond-BoldItalic.otf}
% use CSS to use the declared font family in the document
% serif is used as a fallback
\Css{body{font-family: "rmfamily", serif;}}
\end{texsource}


\section{Math}

\subsection{MathJax}


\subsection{MathML}
\subsection{Subscripts and superscripts}
\input{howto/subscripts}
\subsection{MathJax Node}


\section{Graphics}
\subsection{Include graphics (svg,pdf)}
\subsection{Change image size and resolution}
\input{howto/graphics-size}

\section{Plain \TeX}

\input{howto/plain-sample}

\section{Blogging}

\section{Work with external commands}
\subsection{Indexing}
\subsection{Bibliographies}
\subsection{R}
\subsection{Markdown}
\subsection{PythonTeX}


\input{sections/calling-commands}
\input{sections/output-formats}
\input{sections/tex4ht-options}

\chapter{Configurations}

\input{sections/configuration-files}
\input{sections/tex4ht-commands}
\input{sections/css-styling}
\input{sections/webfonts}
\input{sections/javascript}
\input{sections/document_structure}

% \section{Document Navigation}
\input{sections/crosslinks.tex}


\section{Tables of Contents}

\section{Sections}
\section{Lists}
\section{Tables}

\section{Fonts}
\subsection{Basic font commands}

Information about the \option{fonts} option and \term{MathML} issues. 
Example configuration:
\url{https://tex.stackexchange.com/a/416613/2891}

\section{Multi-lingual support}

RTL support in the ODT output: \url{https://tex.stackexchange.com/a/470434/2891}.

\subsection{Right-to-left text}

There is a difference in the RTL support for HTML and ODT output formats. In HTML, RTL can be requested using:

\DocConfigure{LRdir} { value for the dir attribute}\EndDoc

Example:

\begin{texsource}
\ConfigureEnv{arab}
{\Configure{LRdir}{ dir="rtl"}}
{\Configure{LRdir}{}}{}{}
\end{texsource}

This configuration sets the direction to \term{rtl} inside the \term{arab} environment and resets it after the environment end.

In the ODT output, different mechanism is used:

\begin{texsource}
\ConfigureEnv{arab}{\@rltrue}{\@rlfalse}{}{}
\end{texsource}

\subsection{Unicode}
\label{sec:unicode}

Generally speaking, \texfourht\ supports \term{Unicode}, but there are some
issues to be aware of. Most complete support exists for Lua\LaTeX, thanks to
special Lua script which is automatically loaded during the compilation. No
additional packages are necessary.

PDF\LaTeX\ doesn't support nativelly, but it is possible to emulate it using the
\package{inputenc} and \package{fontenc} packages:

\begin{texsource}
\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\begin{document}
Unicode text
\end{document}
\end{texsource}

Xe\LaTeX\ is an Unicode format, similarly to Lua\LaTeX. The supporting
mechanism for \texfourht\ is different in this case and full Unicode range is
not supported out of the box. By default, only most Latin based characters are
supported. For other scripts, such as Greek or Cyrillic, two ways to enable
support exists. 

First option is to define new font family using \package{fontspec} \texcommand{\newfontfamily} with the \texttt{Script} option.

\begin{texsource}
\newfontfamily\greekfont{Linux Libertine O}[Script=Greek]
\end{texsource}


The second option is to declare load support for a script in the custom config
file using the \texcommand{\xeuniuseblock}:


\begin{texsource}
\xeuniuseblock{Greek}
\end{texsource}

The block names are based on \href{https://en.wikipedia.org/wiki/Unicode_block}{Unicode blocks}.

It is also possible to declare all characters in an Unicode range. The command
\texcommand{\xeuniregisterblockhex} takes two hexadecimal parameters with
Unicode range to be declared.

\begin{texsource}
\xeuniregisterblockhex{0100}{017F}
\end{texsource}

Individual character can be declared using the \texcommand{\xeuniregisterchar} command:

\begin{texsource}
\xeuniregisterchar{"1F00}
\end{texsource}

In contrast to \texcommand{\xeuniregisterblockhex}, it uses decimal numbers by
default, so it is necessary to use the \texttt{"} character in front of
a hexadecimal number.

\begin{warning}
It is possible to run into issues because of the way how Xe\LaTeX\ Unicode
support works. Common problem is filename support, for example in included
graphics. In general, it is better to avoid such filenames. If it is not possible, try to use the \texcommand{\detokenize} command.
\begin{texsource}
  \includegraphics{\detokenize{háček.jpg}}
\end{texsource}
\end{warning}

\section{Colors}

Information about the \texcommand{\color} command:
\url{https://tex.stackexchange.com/a/195677/2891}.
Example of possible configuration for the \texcommand{\color} command: 
\url{https://tex.stackexchange.com/q/470179/2891}.

Example of extracting color information to the CSS and custom color environment support:
\url{https://tex.stackexchange.com/a/422281/2891}. Extracting of color information to the HTML attributes:
\url{https://tex.stackexchange.com/a/390151/2891}.



\section{Graphics and Pictures}

\input{sections/graphics}
\section{TikZ }

Animations using Animate package: \url{https://tex.stackexchange.com/a/404600/2891}

Issues with drivers: \url{https://tex.stackexchange.com/a/471460/2891}.
\section{Pstricks}

\section{Math}
\subsection{Default math handling}
\subsection{MathML}

\mathml\ is a XML markup for the math encoding. It is supported in many
aplications including OpenOffice Writer or Firefox web browser. 
The advantage over use of images % Todo: write about advantages of MathML.

The \mathml\ code produced by \texfourht\ may contain some issues. For example,
one common issue may happen when the math contain unmatched delimiters:

\begin{texsource}
 Mail address: $\lparen$hello@world.com$\rparen$
\end{texsource}

In such cases, the \option{matml-} may help. 

It is also advisable to always use \extension{common\_domfilters}
\term{make4ht} extension (see section \ref{sec:make4ht-extensions} for more
information about \term{make4ht} extensions), as it fixes some common \mathml\
errors that cannot be easily fixed on the \TeX\ level.


If you want to add original \LaTeX\ source as an annotation to your MathML formulas,
you can try a configuration from this \href{https://tex.stackexchange.com/a/637910/2891}{this answer}.

Add information about the \url{https://github.com/pshihn/math-ml} - it adds
support for MathML in all modern web browsers with HTML 5.


\subsection{MathJax}
\texfourht\ supports MathJax, library for math rendering in HTML documents. 
 It supports two modes -- \LaTeX\ math and \mathml.

The \term{MathJax} processing can be required using the \option{mathjax} option.

The address of the \term{MathJax} script and its configuration string can be
specified in the \configuration{MathjaxSource} configuration. Default value of this configuration is:

\begin{texsource}
\Configure{MathjaxSource}
{https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js}
\end{texsource}

\paragraph{\LaTeX\ mode}

In the \LaTeX math mode, \TeX\ macros used in the math mode are preserved in
the output HTML document. They are parsed and rendered by MathJax when the
document is displayed by a web browser. The downside of this mode is that
commands unknown to MathJax must be configured in a special configuration for
MathJax. Cross-references to equations and other numbered math environments
don't work out of the box. You can try the Lua scripts proposed in 
\href{https://tex.stackexchange.com/a/597913/2891}{this post on TeX.sx} as
a workaround.

By default, inline and display math, as well as math environments, are kept as
raw LaTeX code in the \HTML\ output. 

The additional configuration for \term{MathJax} can be provided in the
\configuration{MathJaxConfig} configuration.
The following example provides support for some custom \LaTeX\ macros.

\begin{texsource}
\Preamble{xhtml}
\Configure{MathJaxConfig}{{
    tex: {
      tags: "ams",
      \detokenize{%
      macros: {
        sc: "\\small\\rm",
        sl: "\\it",
      }
  }
}
}}
\begin{document}
\EndPreamble

\end{texsource}


The configuration needs to be passed as a JavaScript object, this means that
you need to use extra \verb|{}| brackets.
The \texcommand{\detokenize} macro is used to avoid issues with backslash
characters used in the macro definitions. Backslashes must be doubled in the
JavaScript strings. Contents of this configuration are already enclosed in the
\texcommand{\HCode} command, so you cannot use it in this configuration.

If you want to define macros with parameters, you may run to issues with the \# character, used for parameters.
You need to change the catcode of this character to letter before the \configuration{MathJaxConfig} configuration:

\begin{texsource}
\Preamble{xhtml}
% change catcode of # to letter
% in order to support #1 in custom
% MathJax macros
\catcode`\#=11
\Configure{MathJaxConfig}{{
    tex: {
      \detokenize{%
      macros: { 
        % our sample macro takes a parameter
        hello: ["\\sqrt{#1}",1],
      }
  }
}
}}
% don't forget to change the catcode 
% back to the original value
\catcode`\#=6
\begin{document}
\EndPreamble
\end{texsource}

\paragraph{Custom environments in MathJax.}\label{sec:mathjax_env}

If you want to add support for a new environment, you can use the \verb|\VerbMath| command, and you will
also need to pass suitable configuration to MathJax. For example for the following TeX file:

\begin{texsource}
\documentclass[12pt]{book}    
\usepackage{amsmath} 
\usepackage{breqn}

\begin{document}    
\begin{dgroup*}
\begin{dmath*}
     A = B
   \end{dmath*}     %error is around here           
\end{dgroup*}
\end{document}
\end{texsource}

Can be configured using this configuration file:

\begin{texsource}
\Preamble{xhtml} 
\Configure{MathJaxConfig}{{ 
    tex: { 
      tags: "ams", 
      \detokenize{% 
        environments: {
          "dgroup*": ["", ""],
          "dmath*": ["", ""],
        } 
      } 
    } 
}} 
\VerbMath{dgroup*}
\begin{document} 
\EndPreamble
\end{texsource}

The \verb|\VerbMath| command can be used just for the \verb|dgroup*| environment, as it will pass the
whole contents, including the \verb|dgroup*| environment, to the HTML file. But you will need to 
provide MathJax configuration for both of these environments, as they are not supported by default.



\paragraph{\mathml\ mode}

Math is converted to \mathml\ by \texfourht, MathJax then renders it. Custom
commands and cross-references work in this mode.

The \mathml\ MathJax mode can be required using the \option{mathml,mathjax} option.

\paragraph{Table of contents issues}

Some math commands may cause issues when they are used in section titles in the MathJax mode. 
This can be fixed using the \texcommand{\fixmathjaxtoc} command:

\begin{texsource}
\fixmathjaxtoc\int
\end{texsource}


\section{Bibliographies}
\section{Indexing}

\section{OpenDocument Format}
\input{sections/odt}

\chapter{Make4ht Build Files}
\label{sec:make4ht-build-files}
\section{Commands execution}
\section{Filters}

Some samples:

\begin{itemize}
  \item Render math by Mathjax during tex4ht compilation \url{https://tex.stackexchange.com/a/402159/2891}
\end{itemize}
\section{Image conversion}

\chapter{FAQ and Troubleshooting}
\input{sections/faq}
\chapter{For Developers}
\input{sections/tex4ht-development}

\chapter{Glossary}
\chapter{Bibliography}
\chapter{Index}
\chapter{Changes}
\input{sections/changes}

\end{document}
